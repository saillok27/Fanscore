<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<meta name="theme-color" content="#0a0c10"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-title" content="Fanscore"/>
<title>Fanscore</title>

<!-- SUPABASE -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Exo+2:wght@300;400;600;800;900&display=swap" rel="stylesheet"/>
<style>
:root {
  --bg0:#060810; --bg1:#0a0d14; --bg2:#0f1520; --bg3:#151e2d; --bg4:#1a2535;
  --teal:#00f0c8; --teal2:#00c9a7; --teal3:#007a66; --teal-glow:rgba(0,240,200,0.18);
  --teal-dim:rgba(0,240,200,0.08); --gold:#f5c842; --gold2:#c49a10;
  --silver:#9eb8c8; --red:#ff3d57; --blue:#4da8ff;
  --txt:#e8edf5; --txt2:#7a90a8; --txt3:#3a4e62;
  --border:rgba(0,240,200,0.12); --border2:rgba(255,255,255,0.06);
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html{height:100%}
body{background:var(--bg0);color:var(--txt);font-family:'Exo 2',sans-serif;min-height:100vh;overflow-x:hidden;}
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,0.03) 2px,rgba(0,0,0,0.03) 4px);}
.ambient{position:fixed;top:-300px;left:50%;transform:translateX(-50%);width:800px;height:600px;pointer-events:none;z-index:0;background:radial-gradient(ellipse at center,rgba(0,240,200,0.055) 0%,transparent 65%);}

/* HEADER */
.hdr{position:sticky;top:0;z-index:100;background:rgba(6,8,16,0.92);backdrop-filter:blur(24px);border-bottom:1px solid var(--border);}
.hdr-inner{display:flex;align-items:center;gap:12px;max-width:500px;margin:0 auto;padding:0 14px;height:52px;}
.logo{font-family:'Rajdhani',sans-serif;font-weight:700;font-size:22px;letter-spacing:3px;text-transform:uppercase;color:var(--txt);flex-shrink:0;}
.logo em{color:var(--teal);font-style:normal;text-shadow:0 0 16px var(--teal);}
.hdr-mid{flex:1;}
.xp-bar-wrap{display:flex;align-items:center;gap:8px;}
.level-badge{background:linear-gradient(135deg,var(--gold2),var(--gold));color:#1a0f00;font-family:'Rajdhani',sans-serif;font-weight:700;font-size:11px;letter-spacing:1px;padding:2px 7px;border-radius:4px;flex-shrink:0;}
.xp-track{flex:1;height:5px;background:rgba(255,255,255,0.06);border-radius:5px;overflow:hidden;}
.xp-fill{height:100%;width:0%;background:linear-gradient(90deg,var(--teal3),var(--teal));border-radius:5px;box-shadow:0 0 8px var(--teal);transition:width 0.5s ease;}
.xp-count{font-family:'Rajdhani',sans-serif;font-weight:600;font-size:13px;color:var(--teal);flex-shrink:0;white-space:nowrap;}
.streak-pill{display:flex;align-items:center;gap:4px;background:rgba(245,200,66,0.1);border:1px solid rgba(245,200,66,0.22);border-radius:6px;padding:3px 8px;flex-shrink:0;font-family:'Rajdhani',sans-serif;font-weight:700;font-size:13px;color:var(--gold);}

/* LOGIN SCREEN */
.login-screen{position:fixed;inset:0;z-index:200;background:var(--bg0);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:24px;padding:32px;}
.login-logo{font-family:'Rajdhani',sans-serif;font-weight:700;font-size:48px;letter-spacing:6px;text-transform:uppercase;}
.login-logo em{color:var(--teal);font-style:normal;text-shadow:0 0 30px var(--teal);}
.login-sub{font-size:14px;color:var(--txt2);text-align:center;line-height:1.6;}
.login-btn{display:flex;align-items:center;gap:12px;background:white;color:#1a1a1a;padding:14px 28px;border-radius:10px;border:none;cursor:pointer;font-family:'Rajdhani',sans-serif;font-weight:700;font-size:16px;letter-spacing:1px;transition:transform 0.15s,box-shadow 0.15s;box-shadow:0 4px 20px rgba(0,0,0,0.4);}
.login-btn:active{transform:scale(0.97);}
.login-btn svg{width:20px;height:20px;}
.login-skip{font-size:12px;color:var(--txt3);cursor:pointer;text-decoration:underline;margin-top:8px;}
.login-skip:active{color:var(--txt2);}

/* PAGES */
.page{display:none;position:relative;z-index:1;}
.page.active{display:block;}

/* LEAGUE BAR */
.league-bar{display:flex;gap:6px;padding:10px 14px;overflow-x:auto;scrollbar-width:none;border-bottom:1px solid var(--border2);background:var(--bg1);}
.league-bar::-webkit-scrollbar{display:none}
.ltab{flex-shrink:0;font-family:'Rajdhani',sans-serif;font-weight:600;font-size:12px;letter-spacing:1px;text-transform:uppercase;color:var(--txt2);padding:5px 14px;border-radius:4px;cursor:pointer;border:1px solid transparent;transition:all .2s;}
.ltab.active{background:var(--teal-dim);border-color:var(--teal3);color:var(--teal);}
.ltab:active{transform:scale(0.96);}

.home-wrap{max-width:500px;margin:0 auto;padding:0 0 80px;}

/* SECTION HEAD */
.sec-head{display:flex;align-items:center;justify-content:space-between;padding:18px 14px 10px;}
.sec-title{font-family:'Rajdhani',sans-serif;font-weight:700;font-size:14px;letter-spacing:2px;text-transform:uppercase;color:var(--txt2);display:flex;align-items:center;gap:8px;}
.sec-title::before{content:'';width:3px;height:14px;background:var(--teal);border-radius:2px;display:inline-block;}
.sec-link{font-family:'Rajdhani',sans-serif;font-size:12px;color:var(--teal);font-weight:600;letter-spacing:0.5px;cursor:pointer;}

/* FIFA CARDS */
.cards-scroll{display:flex;gap:10px;padding:0 14px 4px;overflow-x:auto;scrollbar-width:none;}
.cards-scroll::-webkit-scrollbar{display:none}
.fifa-card{flex-shrink:0;width:145px;border-radius:10px;overflow:hidden;cursor:pointer;border:1px solid rgba(255,255,255,0.06);position:relative;transition:transform .2s,box-shadow .2s;animation:fadeUp .5s ease both;}
.fifa-card:active{transform:scale(0.97);}
.fifa-card.gold{background:linear-gradient(160deg,#2a1f05 0%,#1a1200 40%,#2d2010 100%);border-color:rgba(245,200,66,0.3);box-shadow:0 4px 24px rgba(245,200,66,0.1);}
.fifa-card.teal{background:linear-gradient(160deg,#052220 0%,#021510 40%,#062e28 100%);border-color:rgba(0,240,200,0.25);box-shadow:0 4px 24px rgba(0,240,200,0.08);}
.fifa-card.blue{background:linear-gradient(160deg,#071828 0%,#040f1a 40%,#0a1e30 100%);border-color:rgba(77,168,255,0.2);}
.fifa-card.silver{background:linear-gradient(160deg,#1a1f26 0%,#0f1318 40%,#1c222a 100%);border-color:rgba(158,184,200,0.2);}
.card-top{padding:10px 10px 0;display:flex;justify-content:space-between;align-items:flex-start;}
.card-rating{font-family:'Rajdhani',sans-serif;font-weight:700;font-size:32px;line-height:1;}
.fifa-card.gold .card-rating{color:var(--gold);}
.fifa-card.teal .card-rating{color:var(--teal);}
.fifa-card.blue .card-rating{color:var(--blue);}
.fifa-card.silver .card-rating{color:var(--silver);}
.card-left-info{display:flex;flex-direction:column;align-items:flex-start;gap:2px;}
.card-pos{font-family:'Rajdhani',sans-serif;font-weight:700;font-size:12px;letter-spacing:1px;}
.fifa-card.gold .card-pos{color:var(--gold);}
.fifa-card.teal .card-pos{color:var(--teal);}
.fifa-card.blue .card-pos{color:var(--blue);}
.fifa-card.silver .card-pos{color:var(--silver);}
.card-img-wrap{display:flex;justify-content:center;align-items:center;height:90px;position:relative;overflow:hidden;}
.card-img-wrap::after{content:'';position:absolute;bottom:0;left:0;right:0;height:40px;background:linear-gradient(transparent,rgba(0,0,0,0.5));}
.card-avatar{font-size:58px;user-select:none;line-height:1;}
.card-name{text-align:center;font-family:'Rajdhani',sans-serif;font-weight:700;font-size:13px;letter-spacing:1px;text-transform:uppercase;padding:0 8px 6px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.fifa-card.gold .card-name{color:var(--gold);}
.fifa-card.teal .card-name{color:var(--teal);}
.fifa-card.blue .card-name{color:var(--blue);}
.fifa-card.silver .card-name{color:var(--silver);}
.card-divider{height:1px;margin:0 8px;}
.fifa-card.gold .card-divider{background:rgba(245,200,66,0.2);}
.fifa-card.teal .card-divider{background:rgba(0,240,200,0.15);}
.fifa-card.blue .card-divider{background:rgba(77,168,255,0.15);}
.fifa-card.silver .card-divider{background:rgba(158,184,200,0.12);}
.card-stats{display:grid;grid-template-columns:1fr 1fr;gap:3px;padding:6px 10px 10px;}
.cs{display:flex;flex-direction:column;align-items:center;}
.cs-val{font-family:'Rajdhani',sans-serif;font-weight:700;font-size:14px;line-height:1;}
.cs-lbl{font-size:9px;letter-spacing:0.5px;font-weight:600;}
.fifa-card.gold .cs-val{color:var(--gold);} .fifa-card.gold .cs-lbl{color:rgba(245,200,66,0.5);}
.fifa-card.teal .cs-val{color:var(--teal);} .fifa-card.teal .cs-lbl{color:rgba(0,240,200,0.4);}
.fifa-card.blue .cs-val{color:var(--blue);} .fifa-card.blue .cs-lbl{color:rgba(77,168,255,0.4);}
.fifa-card.silver .cs-val,.fifa-card.silver .cs-lbl{color:var(--silver);opacity:.7;}
.card-locked-overlay{position:absolute;inset:0;background:rgba(6,8,16,0.75);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;border-radius:10px;}
.lock-votes{font-family:'Rajdhani',sans-serif;font-weight:600;font-size:11px;color:var(--txt3);letter-spacing:0.5px;}
.lock-mini-bar{width:50px;height:3px;background:rgba(255,255,255,0.06);border-radius:3px;overflow:hidden;}
.lock-mini-fill{height:100%;background:var(--teal3);border-radius:3px;}

/* RANKING */
.rank-list{display:flex;flex-direction:column;gap:6px;padding:0 14px;}
.rank-row{display:flex;align-items:center;gap:10px;background:var(--bg2);border:1px solid var(--border2);border-radius:8px;padding:10px 12px;cursor:pointer;transition:border-color .2s,transform .2s;animation:fadeUp .4s ease both;}
.rank-row:active{transform:scale(0.98);border-color:var(--teal3);}
.rank-n{font-family:'Rajdhani',sans-serif;font-weight:700;font-size:18px;width:24px;text-align:center;flex-shrink:0;}
.rank-n.g{color:var(--gold);} .rank-n.s{color:var(--silver);} .rank-n.b{color:#a0785a;} .rank-n.o{color:var(--txt3);}
.rank-av{width:40px;height:40px;flex-shrink:0;border-radius:50%;border:1px solid var(--border2);display:flex;align-items:center;justify-content:center;font-size:22px;background:var(--bg3);}
.rank-info{flex:1;min-width:0;}
.rank-name{font-family:'Rajdhani',sans-serif;font-weight:700;font-size:15px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;letter-spacing:0.5px;}
.rank-sub{font-size:11px;color:var(--txt3);margin-top:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.rank-score{flex-shrink:0;text-align:right;}
.rank-val{font-family:'Rajdhani',sans-serif;font-weight:700;font-size:24px;color:var(--teal);line-height:1;}
.rank-votes{font-size:10px;color:var(--txt3);margin-top:2px;}

/* H2H */
.h2h-wrap{margin:0 14px;}
.h2h-card{background:var(--bg2);border:1px solid var(--border2);border-radius:10px;overflow:hidden;}
.h2h-top{padding:10px 14px;background:linear-gradient(90deg,rgba(0,240,200,0.06),transparent);border-bottom:1px solid var(--border2);display:flex;align-items:center;gap:10px;}
.h2h-tag{font-family:'Rajdhani',sans-serif;font-weight:700;font-size:10px;letter-spacing:2px;color:var(--teal);border:1px solid var(--teal3);border-radius:3px;padding:2px 7px;}
.h2h-q{font-size:12px;color:var(--txt2);}
.h2h-arena{display:grid;grid-template-columns:1fr 60px 1fr;align-items:center;padding:16px 14px;}
.h2h-p{text-align:center;}
.h2h-av{width:64px;height:64px;margin:0 auto 8px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:36px;position:relative;}
.h2h-av.a{background:radial-gradient(circle,rgba(0,240,200,0.12),transparent);border:1px solid rgba(0,240,200,0.25);}
.h2h-av.b{background:radial-gradient(circle,rgba(255,61,87,0.12),transparent);border:1px solid rgba(255,61,87,0.25);}
.h2h-pname{font-family:'Rajdhani',sans-serif;font-weight:700;font-size:14px;letter-spacing:0.5px;}
.h2h-pteam{font-size:11px;color:var(--txt3);margin-top:1px;}
.h2h-vs{font-family:'Rajdhani',sans-serif;font-weight:700;font-size:22px;color:var(--txt3);letter-spacing:2px;text-align:center;}
.h2h-actions{display:grid;grid-template-columns:1fr 1fr;border-top:1px solid var(--border2);}
.h2h-btn{padding:13px;cursor:pointer;font-family:'Rajdhani',sans-serif;font-weight:700;font-size:13px;letter-spacing:0.5px;text-align:center;transition:background .15s;user-select:none;}
.h2h-btn:first-child{color:var(--teal);border-right:1px solid var(--border2);border-bottom-left-radius:10px;}
.h2h-btn:last-child{color:var(--red);border-bottom-right-radius:10px;}
.h2h-btn:active{background:var(--bg3);}

/* PLAYER DETAIL */
.detail-page{max-width:500px;margin:0 auto;padding:0 0 90px;}
.detail-back{display:flex;align-items:center;gap:8px;padding:12px 14px;cursor:pointer;font-family:'Rajdhani',sans-serif;font-weight:600;font-size:13px;color:var(--txt2);letter-spacing:1px;border-bottom:1px solid var(--border2);}
.detail-back:active{color:var(--teal);}
.big-card-wrap{padding:16px 14px 0;}
.big-card{border-radius:14px;overflow:hidden;position:relative;border:1px solid rgba(245,200,66,0.25);background:linear-gradient(160deg,#2d2008 0%,#120e02 50%,#1e1604 100%);box-shadow:0 12px 40px rgba(245,200,66,0.08),inset 0 1px 0 rgba(245,200,66,0.15);}
.big-rating{font-family:'Rajdhani',sans-serif;font-weight:700;font-size:52px;color:var(--gold);line-height:1;text-shadow:0 0 30px rgba(245,200,66,0.4);}
.big-pos{font-family:'Rajdhani',sans-serif;font-weight:700;font-size:14px;letter-spacing:1px;color:var(--gold);opacity:0.7;}
.big-name{font-family:'Rajdhani',sans-serif;font-weight:700;font-size:18px;letter-spacing:1px;text-transform:uppercase;color:var(--gold);margin-bottom:2px;}
.big-team{font-size:12px;color:rgba(245,200,66,0.5);margin-bottom:10px;letter-spacing:0.5px;}
.big-stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:4px;}
.bst{display:flex;align-items:center;gap:5px;}
.bst-val{font-family:'Rajdhani',sans-serif;font-weight:700;font-size:15px;color:var(--gold);width:26px;}
.bst-lbl{font-size:10px;color:rgba(245,200,66,0.4);letter-spacing:0.5px;}
.fm-stats-section{padding:14px;}
.fm-title{font-family:'Rajdhani',sans-serif;font-weight:700;font-size:11px;letter-spacing:2px;text-transform:uppercase;color:var(--txt3);margin-bottom:12px;display:flex;align-items:center;gap:8px;}
.fm-title::after{content:'';flex:1;height:1px;background:var(--border2);}
.fm-row{display:flex;align-items:center;gap:10px;margin-bottom:8px;}
.fm-lbl{font-size:12px;font-weight:600;color:var(--txt2);width:88px;flex-shrink:0;}
.fm-bar{flex:1;height:6px;background:rgba(255,255,255,0.05);border-radius:3px;overflow:hidden;}
.fm-fill{height:100%;border-radius:3px;transition:width 1.2s cubic-bezier(0.16,1,0.3,1);}
.fm-fill.hi{background:linear-gradient(90deg,#00a88c,var(--teal));}
.fm-fill.mid{background:linear-gradient(90deg,#c49a10,var(--gold));}
.fm-fill.lo{background:linear-gradient(90deg,#a02030,var(--red));}
.fm-fill.locked{background:rgba(255,255,255,0.05);width:100%!important;}
.fm-num{font-family:'Rajdhani',sans-serif;font-weight:700;font-size:14px;color:var(--teal);width:28px;text-align:right;}
.fm-num.locked{color:var(--txt3);}
.radar-wrap{padding:0 14px 14px;display:flex;justify-content:center;}
.radar-svg{width:200px;height:200px;}

/* VOTE PANEL */
.vote-panel{margin:0 14px;background:var(--bg2);border:1px solid var(--border2);border-radius:10px;overflow:hidden;}
.vote-panel-head{padding:10px 14px;background:rgba(0,240,200,0.04);border-bottom:1px solid var(--border2);font-family:'Rajdhani',sans-serif;font-weight:700;font-size:11px;letter-spacing:2px;color:var(--txt2);}
.vote-panel-body{padding:14px;}
.vtabs{display:flex;gap:6px;margin-bottom:14px;}
.vtab{flex:1;padding:7px;background:var(--bg3);border:1px solid var(--border2);border-radius:6px;cursor:pointer;font-family:'Rajdhani',sans-serif;font-weight:700;font-size:11px;letter-spacing:1px;text-transform:uppercase;color:var(--txt2);text-align:center;transition:all .2s;}
.vtab.active{background:var(--teal-dim);border-color:var(--teal3);color:var(--teal);}
.slider-big{width:100%;-webkit-appearance:none;appearance:none;height:5px;border-radius:5px;background:rgba(255,255,255,0.07);outline:none;cursor:pointer;}
.slider-big::-webkit-slider-thumb{-webkit-appearance:none;width:24px;height:24px;border-radius:50%;background:var(--teal);box-shadow:0 0 14px var(--teal-glow);border:2px solid var(--bg0);cursor:pointer;}
.slider-val-big{text-align:center;margin-bottom:12px;font-family:'Rajdhani',sans-serif;font-weight:700;font-size:52px;color:var(--teal);line-height:1;text-shadow:0 0 40px var(--teal-glow);}
.slider-ends{display:flex;justify-content:space-between;font-size:10px;color:var(--txt3);margin-top:5px;margin-bottom:14px;letter-spacing:0.5px;}
.vote-submit{width:100%;padding:13px;background:linear-gradient(90deg,var(--teal3),var(--teal));border:none;border-radius:8px;font-family:'Rajdhani',sans-serif;font-weight:700;font-size:14px;letter-spacing:2px;text-transform:uppercase;color:var(--bg0);cursor:pointer;box-shadow:0 4px 18px var(--teal-glow);transition:transform .15s,box-shadow .15s;}
.vote-submit:active{transform:scale(0.98);}
.unlock-progress-wrap{background:rgba(0,0,0,0.2);border-radius:6px;padding:10px 12px;margin-bottom:14px;border:1px solid var(--border2);}
.unlock-hd{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;}
.unlock-hd-txt{font-size:11px;color:var(--txt2);}
.unlock-hd-num{font-family:'Rajdhani',sans-serif;font-weight:700;font-size:12px;color:var(--teal);}
.unlock-bar{height:4px;background:rgba(255,255,255,0.06);border-radius:4px;overflow:hidden;}
.unlock-fill{height:100%;border-radius:4px;background:linear-gradient(90deg,var(--teal3),var(--teal));transition:width 0.5s ease;}
.stars-row{display:flex;justify-content:center;gap:10px;margin-bottom:16px;}
.star-btn{font-size:30px;cursor:pointer;transition:transform .15s;filter:grayscale(1) brightness(0.3);}
.star-btn.on{filter:none;transform:scale(1.1);}

/* BOTTOM NAV */
.bnav{position:fixed;bottom:0;left:0;right:0;z-index:100;background:rgba(6,8,16,0.96);backdrop-filter:blur(20px);border-top:1px solid var(--border);padding-bottom:env(safe-area-inset-bottom,0);}
.bnav-inner{display:flex;justify-content:space-around;max-width:500px;margin:0 auto;padding:6px 0;}
.ni{display:flex;flex-direction:column;align-items:center;gap:3px;padding:6px 14px;cursor:pointer;border-radius:8px;transition:all .2s;position:relative;}
.ni.active .ni-ico{color:var(--teal);}
.ni.active .ni-lbl{color:var(--teal);}
.ni.active::before{content:'';position:absolute;top:-7px;left:50%;transform:translateX(-50%);width:28px;height:2px;background:var(--teal);box-shadow:0 0 8px var(--teal);border-radius:0 0 4px 4px;}
.ni-ico{font-size:20px;color:var(--txt3);transition:color .2s;}
.ni-lbl{font-family:'Rajdhani',sans-serif;font-weight:600;font-size:10px;letter-spacing:1px;color:var(--txt3);transition:color .2s;}

/* PROFILE */
.profile-wrap{max-width:500px;margin:0 auto;padding:0 14px 90px;}
.profile-hero{display:flex;flex-direction:column;align-items:center;padding:28px 0 20px;gap:10px;}
.profile-av{width:80px;height:80px;border-radius:50%;background:radial-gradient(circle,var(--teal-dim),var(--bg3));border:2px solid var(--teal3);display:flex;align-items:center;justify-content:center;font-size:44px;overflow:hidden;}
.profile-av img{width:100%;height:100%;object-fit:cover;}
.profile-name{font-family:'Rajdhani',sans-serif;font-weight:700;font-size:22px;letter-spacing:1px;}
.profile-level{display:flex;align-items:center;gap:8px;background:linear-gradient(90deg,rgba(245,200,66,0.08),transparent);border:1px solid rgba(245,200,66,0.15);border-radius:6px;padding:4px 12px;font-family:'Rajdhani',sans-serif;font-weight:700;font-size:13px;color:var(--gold);letter-spacing:1px;}
.profile-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:8px;width:100%;}
.pstat{background:var(--bg2);border:1px solid var(--border2);border-radius:8px;padding:12px;text-align:center;}
.pstat-val{font-family:'Rajdhani',sans-serif;font-weight:700;font-size:22px;color:var(--teal);}
.pstat-lbl{font-size:10px;color:var(--txt3);letter-spacing:0.5px;margin-top:2px;}
.logout-btn{width:100%;margin-top:16px;padding:12px;background:transparent;border:1px solid var(--red);border-radius:8px;color:var(--red);font-family:'Rajdhani',sans-serif;font-weight:700;font-size:13px;letter-spacing:2px;cursor:pointer;transition:background 0.2s;}
.logout-btn:active{background:rgba(255,61,87,0.1);}

/* TOAST */
.toast{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--teal);color:var(--bg0);font-family:'Rajdhani',sans-serif;font-weight:700;font-size:20px;letter-spacing:2px;padding:13px 28px;border-radius:10px;z-index:500;pointer-events:none;animation:toastAnim 1.4s ease forwards;}
@keyframes toastAnim{0%{opacity:0;transform:translate(-50%,-50%) scale(0.8);}15%{opacity:1;transform:translate(-50%,-50%) scale(1);}70%{opacity:1;transform:translate(-50%,-55%) scale(1);}100%{opacity:0;transform:translate(-50%,-65%) scale(0.95);}}
@keyframes fadeUp{from{opacity:0;transform:translateY(14px);}to{opacity:1;transform:translateY(0);}}

/* LOADING */
.loading{display:flex;align-items:center;justify-content:center;padding:40px;gap:10px;color:var(--txt2);font-family:'Rajdhani',sans-serif;font-size:14px;letter-spacing:1px;}
.spinner{width:20px;height:20px;border:2px solid var(--border);border-top-color:var(--teal);border-radius:50%;animation:spin 0.8s linear infinite;}
@keyframes spin{to{transform:rotate(360deg);}}

/* QUEST */
.quest{margin:12px 14px 0;background:linear-gradient(110deg,var(--bg3),var(--bg2));border:1px solid rgba(0,240,200,0.18);border-radius:10px;padding:12px 14px;display:flex;align-items:center;gap:12px;cursor:pointer;transition:transform .2s;}
.quest:active{transform:scale(0.98);}
.quest-ico{width:40px;height:40px;flex-shrink:0;background:var(--teal-dim);border:1px solid var(--border);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:20px;}
.quest-body{flex:1;}
.quest-label{font-family:'Rajdhani',sans-serif;font-weight:700;font-size:11px;letter-spacing:1.5px;color:var(--teal);margin-bottom:2px;}
.quest-desc{font-size:12px;color:var(--txt2);line-height:1.4;}
.quest-reward{font-family:'Rajdhani',sans-serif;font-weight:700;font-size:20px;color:var(--gold);text-align:center;flex-shrink:0;}
.quest-reward span{display:block;font-size:10px;color:var(--txt3);font-weight:400;}
</style>
</head>
<body>
<div class="ambient"></div>

<!-- LOGIN SCREEN -->
<div class="login-screen" id="loginScreen">
  <div class="login-logo">FAN<em>SCORE</em></div>
  <div class="login-sub">Î‘Î¾Î¹Î¿Î»ÏŒÎ³Î·ÏƒÎµ Ï„Î¿Ï…Ï‚ Ï€Î±Î¯ÎºÏ„ÎµÏ‚ Ï„Î¿Ï…<br>Î•Î»Î»Î·Î½Î¹ÎºÎ¿Ï Ï€Î¿Î´Î¿ÏƒÏ†Î±Î¯ÏÎ¿Ï…</div>
  <button class="login-btn" onclick="loginWithGoogle()">
    <svg viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
    Î£Î¥ÎÎ”Î•Î£Î— ÎœÎ• GOOGLE
  </button>
  <div class="login-skip" onclick="skipLogin()">Î£Ï…Î½Î­Ï‡ÎµÎ¹Î± Ï‡Ï‰ÏÎ¯Ï‚ ÏƒÏÎ½Î´ÎµÏƒÎ· (Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·)</div>
</div>

<!-- HEADER -->
<div class="hdr" id="mainHeader" style="display:none;">
  <div class="hdr-inner">
    <div class="logo">FAN<em>SCORE</em></div>
    <div class="hdr-mid">
      <div class="xp-bar-wrap">
        <div class="level-badge" id="levelBadge">BRONZE</div>
        <div class="xp-track"><div class="xp-fill" id="xpFill"></div></div>
        <div class="xp-count" id="xpCount">0 XP</div>
      </div>
    </div>
    <div class="streak-pill">ğŸ”¥<span id="streakN">0</span></div>
  </div>
</div>

<!-- PAGE: HOME -->
<div class="page" id="page-home">
  <div class="home-wrap">
    <div class="league-bar">
      <div class="ltab active" onclick="selLeague(this,'Super League')">Î‘' Î•Î˜ÎÎ™ÎšÎ—</div>
      <div class="ltab" onclick="selLeague(this,'Super League 2')">Î’' Î•Î˜ÎÎ™ÎšÎ—</div>
      <div class="ltab" style="opacity:.35;pointer-events:none;">Î“' Î•Î˜ÎÎ™ÎšÎ—</div>
    </div>

    <div class="quest" onclick="showToast('ğŸ¯ Quest ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®Î¸Î·ÎºÎµ!')">
      <div class="quest-ico">ğŸ¯</div>
      <div class="quest-body">
        <div class="quest-label">DAILY QUEST</div>
        <div class="quest-desc">Î’Î±Î¸Î¼Î¿Î»ÏŒÎ³Î·ÏƒÎµ 5 Ï€Î±Î¯ÎºÏ„ÎµÏ‚ ÏƒÎ®Î¼ÎµÏÎ±</div>
      </div>
      <div class="quest-reward">+20<span>XP</span></div>
    </div>

    <div class="sec-head">
      <div class="sec-title">HOT RIGHT NOW</div>
      <div class="sec-link" onclick="gotoPage('page-players')">ÎŸÎ›Î‘ â†’</div>
    </div>
    <div class="cards-scroll" id="hotCards">
      <div class="loading"><div class="spinner"></div>Î¦ÎŸÎ¡Î¤Î©Î£Î—...</div>
    </div>

    <div class="sec-head">
      <div class="sec-title">TOP RANKING</div>
      <div class="sec-link" onclick="gotoPage('page-players')">Î Î›Î—Î¡Î•Î£ â†’</div>
    </div>
    <div class="rank-list" id="rankList">
      <div class="loading"><div class="spinner"></div>Î¦ÎŸÎ¡Î¤Î©Î£Î—...</div>
    </div>
  </div>
</div>

<!-- PAGE: PLAYERS -->
<div class="page" id="page-players">
  <div class="home-wrap">
    <div class="league-bar">
      <div class="ltab active">Î‘' Î•Î˜ÎÎ™ÎšÎ—</div>
    </div>
    <div class="rank-list" id="allPlayersList" style="padding-top:12px;">
      <div class="loading"><div class="spinner"></div>Î¦ÎŸÎ¡Î¤Î©Î£Î—...</div>
    </div>
  </div>
</div>

<!-- PAGE: H2H -->
<div class="page" id="page-h2h">
  <div class="home-wrap">
    <div style="padding:14px;" id="h2hContent">
      <div class="loading"><div class="spinner"></div>Î¦ÎŸÎ¡Î¤Î©Î£Î—...</div>
    </div>
  </div>
</div>

<!-- PAGE: PLAYER DETAIL -->
<div class="page" id="page-player">
  <div class="detail-page">
    <div class="detail-back" onclick="gotoPage(prevPage)">â† Î Î™Î£Î©</div>
    <div class="big-card-wrap">
      <div class="big-card">
        <div style="display:grid;grid-template-columns:90px 1fr;">
          <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;padding:16px 0 16px 16px;gap:4px;">
            <div class="big-rating" id="d-rating">â€”</div>
            <div class="big-pos" id="d-pos">â€”</div>
          </div>
          <div style="display:flex;flex-direction:column;justify-content:center;padding:14px 16px 14px 0;">
            <div class="big-name" id="d-name">â€”</div>
            <div class="big-team" id="d-team">â€”</div>
            <div class="big-stats-grid" id="d-stats-grid"></div>
          </div>
        </div>
        <div style="display:flex;justify-content:center;padding-bottom:12px;">
          <div style="font-size:70px;" id="d-avatar">âš½</div>
        </div>
      </div>
    </div>
    <div class="radar-wrap" style="padding-top:14px;">
      <svg class="radar-svg" viewBox="0 0 200 200" id="radarSvg"></svg>
    </div>
    <div class="fm-stats-section">
      <div class="fm-title">Î£Î¤Î‘Î¤Î™Î£Î¤Î™ÎšÎ‘</div>
      <div id="fm-rows"></div>
    </div>
    <div class="vote-panel">
      <div class="vote-panel-head">Î‘ÎÎ™ÎŸÎ›ÎŸÎ“Î—Î£Î• Î¤ÎŸÎ Î Î‘Î™ÎšÎ¤Î—</div>
      <div class="vote-panel-body">
        <div id="unlockBarWrap" class="unlock-progress-wrap" style="display:none">
          <div class="unlock-hd">
            <div class="unlock-hd-txt">ğŸ”’ Î¨Î®Ï†Î¹ÏƒÎµ Î³Î¹Î± Î½Î± Î¾ÎµÎºÎ»ÎµÎ¹Î´ÏÏƒÎµÎ¹Ï‚ Ï„Î± stats</div>
            <div class="unlock-hd-num" id="unlockNums">0/20</div>
          </div>
          <div class="unlock-bar"><div class="unlock-fill" id="unlockFill" style="width:0%"></div></div>
        </div>
        <div class="vtabs">
          <div class="vtab active" onclick="setVtab(this,'vt-slider')">1â€“100</div>
          <div class="vtab" onclick="setVtab(this,'vt-stars')">â­ Î‘Î£Î¤Î•Î¡Î™Î‘</div>
        </div>
        <div id="vt-slider">
          <div class="slider-val-big" id="svBig">72</div>
          <input type="range" class="slider-big" min="1" max="100" value="72" oninput="document.getElementById('svBig').textContent=this.value"/>
          <div class="slider-ends"><span>1 â€” Î‘Î´ÏÎ½Î±Î¼Î¿Ï‚</span><span>100 â€” Î˜ÎµÏŒÏ‚</span></div>
          <br/>
          <button class="vote-submit" onclick="submitVote()">âš¡ Î¨Î—Î¦Î™Î£Î• â€” +5 XP</button>
        </div>
        <div id="vt-stars" style="display:none">
          <div class="stars-row" id="starsRow">
            <div class="star-btn on" onclick="setStar(1)">â­</div>
            <div class="star-btn on" onclick="setStar(2)">â­</div>
            <div class="star-btn on" onclick="setStar(3)">â­</div>
            <div class="star-btn on" onclick="setStar(4)">â­</div>
            <div class="star-btn" onclick="setStar(5)">â­</div>
          </div>
          <button class="vote-submit" onclick="submitVote()">âš¡ Î¨Î—Î¦Î™Î£Î• â€” +5 XP</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- PAGE: PROFILE -->
<div class="page" id="page-profile">
  <div class="profile-wrap">
    <div class="profile-hero">
      <div class="profile-av" id="profileAv">ğŸ˜</div>
      <div class="profile-name" id="profileName">â€”</div>
      <div class="profile-level" id="profileLevel">ğŸ¥‰ BRONZE SCOUT</div>
      <div class="profile-stats">
        <div class="pstat"><div class="pstat-val" id="pXP">0</div><div class="pstat-lbl">XP</div></div>
        <div class="pstat"><div class="pstat-val" id="pVotes">0</div><div class="pstat-lbl">Î¨Î—Î¦ÎŸÎ™</div></div>
        <div class="pstat"><div class="pstat-val" id="pStreak">ğŸ”¥0</div><div class="pstat-lbl">STREAK</div></div>
      </div>
    </div>
    <button class="logout-btn" onclick="logout()">Î‘Î ÎŸÎ£Î¥ÎÎ”Î•Î£Î—</button>
  </div>
</div>

<!-- BOTTOM NAV -->
<div class="bnav" id="mainNav" style="display:none;">
  <div class="bnav-inner">
    <div class="ni active" onclick="navClick(this,'page-home')"><div class="ni-ico">ğŸ </div><div class="ni-lbl">HOME</div></div>
    <div class="ni" onclick="navClick(this,'page-players')"><div class="ni-ico">âš½</div><div class="ni-lbl">Î Î‘Î™ÎšÎ¤Î•Î£</div></div>
    <div class="ni" onclick="navClick(this,'page-h2h')"><div class="ni-ico">âš”ï¸</div><div class="ni-lbl">H2H</div></div>
    <div class="ni" onclick="navClick(this,'page-profile')"><div class="ni-ico">ğŸ‘¤</div><div class="ni-lbl">PROFILE</div></div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SUPABASE INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SUPABASE_URL = 'https://xszsyiqvznozidbhoowg.supabase.co';
const SUPABASE_ANON_KEY = 'sb_publishable_b56eRu0nrBDvz93EzKHMEg_cRUoBx_3';
const { createClient } = supabase;
const db = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentUser = null;
let currentProfile = null;
let currentPlayer = null;
let prevPage = 'page-home';
let allPlayers = [];
let selectedStars = 4;

const AVATARS = ['âš½','ğŸ§‘ğŸ½','ğŸ§‘ğŸ»','ğŸ§‘ğŸ¼','ğŸ§”ğŸ»','ğŸ§‘ğŸ¾','ğŸ§‘ğŸ¿','ğŸ‘¨ğŸ»','ğŸ‘¨ğŸ½','ğŸ‘¨ğŸ¾'];
const CARD_TYPES = ['gold','teal','blue','silver'];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loginWithGoogle() {
  const { error } = await db.auth.signInWithOAuth({
    provider: 'google',
    options: { redirectTo: window.location.origin }
  });
  if (error) showToast('âŒ Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚');
}

async function skipLogin() {
  document.getElementById('loginScreen').style.display = 'none';
  document.getElementById('mainHeader').style.display = 'block';
  document.getElementById('mainNav').style.display = 'block';
  showPage('page-home');
  await loadPlayers();
}

async function logout() {
  await db.auth.signOut();
  currentUser = null;
  currentProfile = null;
  document.getElementById('loginScreen').style.display = 'flex';
  document.getElementById('mainHeader').style.display = 'none';
  document.getElementById('mainNav').style.display = 'none';
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
}

async function initAuth() {
  const { data: { session } } = await db.auth.getSession();
  if (session) {
    currentUser = session.user;
    await loadProfile();
    // Î‘Î½ Î´ÎµÎ½ Î­Ï‡ÎµÎ¹ Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÎ¹ onboarding â†’ redirect
    if (!currentProfile?.fav_team_id) {
      window.location.href = '/onboarding.html';
      return;
    }
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('mainHeader').style.display = 'block';
    document.getElementById('mainNav').style.display = 'block';
    showPage('page-home');
    await loadPlayers();
  }

  db.auth.onAuthStateChange(async (event, session) => {
    if (event === 'SIGNED_IN' && session) {
      currentUser = session.user;
      await loadProfile();
      // Î‘Î½ Î´ÎµÎ½ Î­Ï‡ÎµÎ¹ Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÎ¹ onboarding â†’ redirect
      if (!currentProfile?.fav_team_id) {
        window.location.href = '/onboarding.html';
        return;
      }
      document.getElementById('loginScreen').style.display = 'none';
      document.getElementById('mainHeader').style.display = 'block';
      document.getElementById('mainNav').style.display = 'block';
      showPage('page-home');
      await loadPlayers();
    }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PROFILE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadProfile() {
  if (!currentUser) return;
  let { data } = await db.from('profiles').select('*').eq('id', currentUser.id).single();
  if (!data) {
    const { data: newProfile } = await db.from('profiles').insert({
      id: currentUser.id,
      username: currentUser.user_metadata?.full_name || 'Scout',
      avatar_url: currentUser.user_metadata?.avatar_url || null,
      xp: 0, streak: 0
    }).select().single();
    data = newProfile;
  }
  currentProfile = data;
  updateProfileUI();
}

function updateProfileUI() {
  if (!currentProfile) return;
  const xp = currentProfile.xp || 0;
  const streak = currentProfile.streak || 0;
  const name = currentProfile.username || 'Scout';

  document.getElementById('xpCount').textContent = xp + ' XP';
  document.getElementById('xpFill').style.width = Math.min(100, (xp / 500) * 100) + '%';
  document.getElementById('streakN').textContent = streak;
  document.getElementById('profileName').textContent = name;
  document.getElementById('pXP').textContent = xp;
  document.getElementById('pStreak').textContent = 'ğŸ”¥' + streak;

  const level = xp < 100 ? 'BRONZE' : xp < 300 ? 'SILVER' : xp < 600 ? 'GOLD' : 'EXPERT';
  const levelEmoji = xp < 100 ? 'ğŸ¥‰' : xp < 300 ? 'ğŸ¥ˆ' : xp < 600 ? 'ğŸ¥‡' : 'ğŸ’';
  document.getElementById('levelBadge').textContent = level;
  document.getElementById('profileLevel').textContent = levelEmoji + ' ' + level + ' SCOUT';

  const av = document.getElementById('profileAv');
  if (currentUser?.user_metadata?.avatar_url) {
    av.innerHTML = `<img src="${currentUser.user_metadata.avatar_url}" alt="avatar"/>`;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PLAYERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadPlayers() {
  const { data, error } = await db.from('players').select('*').order('name');
  if (error) { console.error(error); return; }
  allPlayers = data || [];

  // Load vote counts
  const { data: votesData } = await db.from('votes').select('player_id, score');
  const voteCounts = {};
  const voteAvgs = {};
  if (votesData) {
    votesData.forEach(v => {
      if (!voteCounts[v.player_id]) { voteCounts[v.player_id] = 0; voteAvgs[v.player_id] = []; }
      voteCounts[v.player_id]++;
      voteAvgs[v.player_id].push(v.score);
    });
  }

  allPlayers = allPlayers.map((p, i) => ({
    ...p,
    voteCount: voteCounts[p.id] || 0,
    avgScore: voteAvgs[p.id] ? Math.round(voteAvgs[p.id].reduce((a,b)=>a+b,0)/voteAvgs[p.id].length) : null,
    cardType: CARD_TYPES[i % CARD_TYPES.length],
    avatar: AVATARS[i % AVATARS.length],
    locked: (voteCounts[p.id] || 0) < 20
  }));

  renderHotCards();
  renderRankList();
  renderAllPlayers();
  renderH2H();

  if (currentUser) {
    const { count } = await db.from('votes').select('*', {count:'exact',head:true}).eq('user_id', currentUser.id);
    document.getElementById('pVotes').textContent = count || 0;
  }
}

function renderHotCards() {
  const top4 = [...allPlayers].sort((a,b) => (b.voteCount - a.voteCount)).slice(0, 6);
  document.getElementById('hotCards').innerHTML = top4.map((p, i) => buildFifaCard(p, i)).join('');
}

function buildFifaCard(p, i) {
  const rating = p.avgScore || '?';
  const locked = p.locked;
  const type = p.cardType;
  const statsHtml = locked
    ? `<div class="card-locked-overlay"><div style="font-size:22px;opacity:0.6;">ğŸ”’</div><div class="lock-mini-bar"><div class="lock-mini-fill" style="width:${Math.min(100,(p.voteCount/20)*100)}%"></div></div><div class="lock-votes">${p.voteCount} / 20 ÏˆÎ®Ï†Î¿Î¹</div></div>`
    : `<div class="card-divider"></div><div class="card-stats"><div class="cs"><div class="cs-val">${rating}</div><div class="cs-lbl">RATING</div></div><div class="cs"><div class="cs-val">${p.voteCount}</div><div class="cs-lbl">Î¨Î—Î¦ÎŸÎ™</div></div></div>`;
  return `
    <div class="fifa-card ${type}" onclick="openPlayer('${p.id}')" style="animation-delay:${i*0.05}s">
      <div class="card-top"><div class="card-left-info">
        <div class="card-rating">${locked ? '?' : rating}</div>
        <div class="card-pos">${p.position?.substring(0,3).toUpperCase() || 'MID'}</div>
      </div></div>
      <div class="card-img-wrap"><div class="card-avatar">${p.avatar}</div></div>
      <div class="card-name">${p.name.split(' ').pop()}</div>
      ${statsHtml}
    </div>`;
}

function renderRankList() {
  const sorted = [...allPlayers].filter(p => !p.locked && p.avgScore).sort((a,b) => b.avgScore - a.avgScore);
  const medals = ['g','s','b','o','o','o'];
  document.getElementById('rankList').innerHTML = sorted.slice(0,6).map((p,i) => `
    <div class="rank-row" onclick="openPlayer('${p.id}')" style="animation-delay:${i*0.04}s">
      <div class="rank-n ${medals[i]||'o'}">${i+1}</div>
      <div class="rank-av">${p.avatar}</div>
      <div class="rank-info">
        <div class="rank-name">${p.name}</div>
        <div class="rank-sub">${p.team} Â· ${p.position}</div>
      </div>
      <div class="rank-score">
        <div class="rank-val">${p.avgScore}</div>
        <div class="rank-votes">${p.voteCount} ÏˆÎ®Ï†Î¿Î¹</div>
      </div>
    </div>`).join('') || '<div class="loading">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î±Î¾Î¹Î¿Î»Î¿Î³Î®ÏƒÎµÎ¹Ï‚ Î±ÎºÏŒÎ¼Î±</div>';
}

function renderAllPlayers() {
  const sorted = [...allPlayers].sort((a,b) => b.voteCount - a.voteCount);
  const medals = ['g','s','b'];
  document.getElementById('allPlayersList').innerHTML = sorted.map((p,i) => `
    <div class="rank-row" onclick="openPlayer('${p.id}')" style="animation-delay:${i*0.03}s">
      <div class="rank-n ${medals[i]||'o'}">${i+1}</div>
      <div class="rank-av">${p.avatar}</div>
      <div class="rank-info">
        <div class="rank-name">${p.name}</div>
        <div class="rank-sub">${p.team} Â· ${p.position}</div>
      </div>
      <div class="rank-score">
        <div class="rank-val">${p.locked ? '<span style="color:var(--txt3);font-size:16px;">???</span>' : (p.avgScore||'â€”')}</div>
        <div class="rank-votes">${p.voteCount} ÏˆÎ®Ï†Î¿Î¹</div>
      </div>
    </div>`).join('');
}

function renderH2H() {
  const eligible = allPlayers.filter(p => p.voteCount > 0);
  if (eligible.length < 2) {
    document.getElementById('h2hContent').innerHTML = '<div class="loading">Î§ÏÎµÎ¹Î¬Î¶Î¿Î½Ï„Î±Î¹ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ ÏˆÎ®Ï†Î¿Î¹ Î³Î¹Î± H2H</div>';
    return;
  }
  const shuffle = [...eligible].sort(() => Math.random() - 0.5);
  const p1 = shuffle[0], p2 = shuffle[1];
  document.getElementById('h2hContent').innerHTML = `
    <div class="h2h-card">
      <div class="h2h-top"><div class="h2h-tag">H2H</div><div class="h2h-q">Î Î¿Î¹Î¿Ï‚ ÎµÎ¯Î½Î±Î¹ ÎºÎ±Î»ÏÏ„ÎµÏÎ¿Ï‚;</div></div>
      <div class="h2h-arena">
        <div class="h2h-p"><div class="h2h-av a">${p1.avatar}</div><div class="h2h-pname">${p1.name.split(' ').pop()}</div><div class="h2h-pteam">${p1.team}</div></div>
        <div class="h2h-vs">VS</div>
        <div class="h2h-p"><div class="h2h-av b">${p2.avatar}</div><div class="h2h-pname">${p2.name.split(' ').pop()}</div><div class="h2h-pteam">${p2.team}</div></div>
      </div>
      <div class="h2h-actions">
        <div class="h2h-btn" onclick="doH2H('${p1.id}','${p1.name}')">ğŸ‘ˆ ${p1.name.split(' ').pop().toUpperCase()}</div>
        <div class="h2h-btn" onclick="doH2H('${p2.id}','${p2.name}')">Î•Î ÎŸÎœÎ•ÎÎŸ ğŸ‘‰</div>
      </div>
    </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PLAYER DETAIL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openPlayer(id) {
  const p = allPlayers.find(x => x.id === id);
  if (!p) return;
  currentPlayer = p;

  document.getElementById('d-name').textContent = p.name.toUpperCase();
  document.getElementById('d-team').textContent = p.team.toUpperCase();
  document.getElementById('d-pos').textContent = p.position?.substring(0,3).toUpperCase() || 'MID';
  document.getElementById('d-avatar').textContent = p.avatar;
  document.getElementById('d-rating').textContent = p.locked ? '?' : (p.avgScore || 'â€”');

  document.getElementById('d-stats-grid').innerHTML = `
    <div class="bst"><div class="bst-val">${p.avgScore||'?'}</div><div class="bst-lbl">RATING</div></div>
    <div class="bst"><div class="bst-val">${p.voteCount}</div><div class="bst-lbl">Î¨Î—Î¦ÎŸÎ™</div></div>
    <div class="bst"><div class="bst-val">${p.age||'â€”'}</div><div class="bst-lbl">Î—Î›Î™ÎšÎ™Î‘</div></div>
    <div class="bst"><div class="bst-val">${p.nationality||'GR'}</div><div class="bst-lbl">Î•Î˜ÎÎ™Îš.</div></div>`;

  buildFMRows(p);
  buildRadar(p);

  if (p.locked) {
    document.getElementById('unlockBarWrap').style.display = 'block';
    document.getElementById('unlockNums').textContent = `${p.voteCount}/20`;
    document.getElementById('unlockFill').style.width = Math.min(100,(p.voteCount/20)*100) + '%';
  } else {
    document.getElementById('unlockBarWrap').style.display = 'none';
  }

  prevPage = document.querySelector('.page.active')?.id || 'page-home';
  gotoPage('page-player');
}

function buildFMRows(p) {
  const stats = [
    {lbl:'Rating', val: p.locked ? null : p.avgScore},
    {lbl:'Î¨Î®Ï†Î¿Î¹', val: p.voteCount},
    {lbl:'Î—Î»Î¹ÎºÎ¯Î±', val: p.age},
    {lbl:'Î•Î¸Î½Î¹ÎºÏŒÏ„Î·Ï„Î±', val: p.nationality === 'GR' ? 'Î•Î»Î»Î¬Î´Î±' : p.nationality},
  ];
  document.getElementById('fm-rows').innerHTML = stats.map(s => {
    const isNum = typeof s.val === 'number';
    const cls = !isNum ? '' : s.val >= 70 ? 'hi' : s.val >= 50 ? 'mid' : 'lo';
    const w = isNum ? s.val : 0;
    return `<div class="fm-row">
      <div class="fm-lbl">${s.lbl}</div>
      <div class="fm-bar"><div class="fm-fill ${s.val===null?'locked':cls}" style="width:${s.val===null?100:Math.min(100,w)}%"></div></div>
      <div class="fm-num${s.val===null?' locked':''}">${s.val===null?'???':s.val}</div>
    </div>`;
  }).join('');
}

function buildRadar(p) {
  const svg = document.getElementById('radarSvg');
  const cx=100, cy=100, r=72;
  const keys = ['Rating','Î¨Î®Ï†Î¿Î¹','ÎŸÎ¼Î¬Î´Î±','Î˜Î­ÏƒÎ·','Î•Î¸Î½Î¹Îº.','Î—Î»Î¹ÎºÎ¯Î±'];
  const rawVals = [p.avgScore||0, Math.min(100,p.voteCount*5), 70, 65, 75, 70];
  const vals = p.locked ? [0,0,0,0,0,0] : rawVals;
  const n = keys.length;
  const toXY = (i, val) => {
    const angle = (Math.PI*2/n)*i - Math.PI/2;
    const dist = (val/100)*r;
    return [cx + dist*Math.cos(angle), cy + dist*Math.sin(angle)];
  };
  let g = '';
  [20,40,60,80,100].forEach(pct => {
    const pts = keys.map((_,i) => toXY(i,pct).join(',')).join(' ');
    g += `<polygon points="${pts}" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>`;
  });
  keys.forEach((_,i) => { const[x,y]=toXY(i,100); g+=`<line x1="${cx}" y1="${cy}" x2="${x}" y2="${y}" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>`; });
  const dataPts = vals.map((v,i) => toXY(i,v).join(',')).join(' ');
  let labels = '';
  keys.forEach((k,i) => { const[x,y]=toXY(i,118); labels+=`<text x="${x}" y="${y}" text-anchor="middle" dominant-baseline="middle" fill="#7a90a8" font-family="Rajdhani,sans-serif" font-size="10" font-weight="700">${k}</text>`; });
  svg.innerHTML = `${g}<polygon points="${dataPts}" fill="rgba(0,240,200,0.12)" stroke="var(--teal)" stroke-width="1.5"/>${vals.map((v,i)=>{const[x,y]=toXY(i,v);return`<circle cx="${x}" cy="${y}" r="3" fill="var(--teal)"/>`;}).join('')}${labels}`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VOTING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function submitVote() {
  if (!currentPlayer) return;
  const score = parseInt(document.getElementById('svBig').textContent);

  if (!currentUser) { showToast('ğŸ”’ Î£Ï…Î½Î´Î­ÏƒÎ¿Ï… Î³Î¹Î± Î½Î± ÏˆÎ·Ï†Î¯ÏƒÎµÎ¹Ï‚!'); return; }

  const { error } = await db.from('votes').upsert({
    player_id: currentPlayer.id,
    user_id: currentUser.id,
    score: score
  }, { onConflict: 'player_id,user_id' });

  if (error) { showToast('âŒ Î£Ï†Î¬Î»Î¼Î±: ' + error.message); return; }

  // Add XP
  const newXP = (currentProfile?.xp || 0) + 5;
  await db.from('profiles').update({ xp: newXP }).eq('id', currentUser.id);
  if (currentProfile) currentProfile.xp = newXP;
  updateProfileUI();

  showToast('âš¡ +5 XP ÎšÎ•Î¡Î”Î™Î£Î•Î£!');
  await loadPlayers();
  gotoPage(prevPage);
}

async function doH2H(playerId, playerName) {
  if (!currentUser) { showToast('ğŸ”’ Î£Ï…Î½Î´Î­ÏƒÎ¿Ï… Î³Î¹Î± Î½Î± ÏˆÎ·Ï†Î¯ÏƒÎµÎ¹Ï‚!'); return; }
  const score = Math.floor(Math.random() * 20) + 70;
  await db.from('votes').upsert({ player_id: playerId, user_id: currentUser.id, score }, { onConflict: 'player_id,user_id' });
  const newXP = (currentProfile?.xp || 0) + 8;
  await db.from('profiles').update({ xp: newXP }).eq('id', currentUser.id);
  if (currentProfile) currentProfile.xp = newXP;
  updateProfileUI();
  showToast(`âœ… ${playerName.split(' ').pop()} â€” +8 XP`);
  await loadPlayers();
  renderH2H();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function gotoPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(id)?.classList.add('active');
  window.scrollTo(0,0);
}
function showPage(id) { gotoPage(id); }
function navClick(el, pageId) {
  document.querySelectorAll('.ni').forEach(n => n.classList.remove('active'));
  el.classList.add('active');
  prevPage = pageId;
  gotoPage(pageId);
}
function selLeague(el) {
  el.closest('.league-bar').querySelectorAll('.ltab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
}
function setVtab(el, id) {
  document.querySelectorAll('.vtab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('vt-slider').style.display = id==='vt-slider'?'block':'none';
  document.getElementById('vt-stars').style.display = id==='vt-stars'?'block':'none';
}
function setStar(n) {
  selectedStars = n;
  document.querySelectorAll('.star-btn').forEach((s,i) => s.classList.toggle('on', i<n));
  document.getElementById('svBig').textContent = Math.round(n * 20);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showToast(msg) {
  const el = document.createElement('div');
  el.className = 'toast'; el.textContent = msg;
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 1400);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
initAuth();
</script>
</body>
</html>
